<!DOCTYPE html>
<html lang="en" ng-app='myApp'>
<head>
	<meta charset="UTF-8">
	<title>angular使用</title>
	<style>
		.outDiv {
			width: 800px;height: 130px;background-color: red;
		}
		.innerDiv {
			background-color: blue;width: 100px;height: 100px;float: left;line-height: 30px;text-align: center;
		}
		.innerDiv .tt {
			color: white;font-size: 20px;margin-left: 5px;
		}
		.outDiv a {
			line-height: 40px;margin-left: 300px;
		}
		li {
			background-color: #999;width: 400px;line-height: 24px;color: green;
		}
		li a {
			float: right;
		}
		li span{
			color: black;
		}
	</style>
</head>
<body>
	<div ng-controller="main">
		<yq-showList ng-show="listFlag"></yq-showList>
		<yq-getpage   ng-show="!listFlag"></yq-getpage>
		<button  ng-show="!listFlag" ng-click="change()">学生列表</button>
		<button  ng-show="listFlag" ng-click="change()">首页</button>
		<yq-addpage></yq-addpage>
	</div>
	<div ng-controller="useSub">
		<button ng-click="getUserList()">提交</button>
		<div ng-repeat="stu in stusInfo track by stu.score " >
			<p>{{ stu }}</p>
		</div>
	</div>
</body>
<script type="text/javascript" src="/bower_components/angular/angular.js"></script>
<script type="text/ng-template" id="addTemp">
	<div>
		<ul ng-repeat="add in adds">
			<li><span>name:</span> {{ add.name }}&nbsp;&nbsp;&nbsp;
			<span>sex:</span> {{ add.sex }} &nbsp;&nbsp;&nbsp;
			<span>socre:</span>{{ add.score }}
			<a href="#" ng-click="delete(add)" >delete</a>
			</li>
		</ul>			
	</div>
</script>
<script type="text/ng-template" id="listTemp">
	<div class="outDiv">
		<div ng-repeat="stu in stus">
			<div class="innerDiv">
				姓名:<span class="tt">{{ stu.name }}</span><br>
				性别:<span class="tt">{{ stu.sex }}</span> <br>
				分数:<span class="tt">{{ stu.score }}</span> <br>
				<button ng-disabled="stu.change_flag" ng-click="addStu(stu);">ADD</button>
			</div>
		</div>
	</div>
</script>
<script type="text/ng-template" id="getTemp">
	<div class="outDiv">
		<h3>秋季大招生的活动开始了,点击学生列表即可看到优秀毕业学生</h3>	
	</div>
</script>
<script type="text/javascript">
	Array.prototype.remove = function(obj){
		var flag = false;
		for(var i=0;i<this.length;i++){
			if(this[i] == obj){
				flag = !flag;
				break;
			}
		}
		if(flag)this.splice(i,1);
	}

	Array.prototype.has = function(obj){
		var flag = false;
		for(var i=0;i<this.length;i++){
			if(this[i] == obj){
				flag =!flag;
				break;
			}
		}
		return flag;
	}

	var app = angular.module('myApp',[]);
	app.factory('$_getUser',[
		function(){
			return {
				get:function(){
					return [
						{_id:1,name:'lala1',sex:'男',score:'801'},
						{_id:2,name:'lala2',sex:'女',score:'802'},
						{_id:3,name:'lala3',sex:'男',score:'803'},
						{_id:4,name:'lala4',sex:'女',score:'804'},
						{_id:4,name:'lala5',sex:'女',score:'805'},
						{_id:4,name:'lala6',sex:'女',score:'806'},
						{_id:4,name:'lala7',sex:'女',score:'807'},

					]
				}
			}
		}
	]);

	app.service('$_saveAdd',[function(){
		var load = [];
		return {
			set:function(array){
				load = array;
			},
			get:function(){
				return load;
			}
		}
	}])

	app.directive('yqShowlist',function(){
		return {
			restrict:'EAC',
			templateUrl:'listTemp'
		}
	})

	app.directive('yqGetpage',function(){
		return {
			restrict:'EAC',
			templateUrl:'getTemp'
		}
	})

	app.directive('yqAddpage',function(){
		return {
			restrict:'EAC',
			templateUrl:'addTemp'
		}
	})

	app.controller('main',['$scope','$_getUser','$_saveAdd',
		function($scope,$_getUser,$_saveAdd){
			$scope.adds = [];
			$scope.change = function(){
				var stus_ori = $_getUser.get();
				stus_ori.forEach(function(s){
					s.change_flag = false;
				});
				$scope.stus = stus_ori;
				$scope.listFlag = !$scope.listFlag;
			}
			$scope.addStu = function(stu){
				if(!$scope.adds.has(stu)){
					stu.change_flag = true;
					$scope.adds.push(stu);
					$_saveAdd.set($scope.adds);
				}
			}
			$scope.delete = function(stu){
				stu.change_flag = false;
				$scope.adds.remove(stu);
			}
			$scope.getUsers = function(){
			}
		}
	]);

	app.controller('useSub',['$scope','$_saveAdd',
		function($scope,$_saveAdd){
			$scope.getUserList = function(){
				$scope.stusInfo = $_saveAdd.get();
			}
		}
	])
</script>
</html>